(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[28],{"+UO9":function(e,t,s){"use strict";s.r(t);var a=s("lSNA"),o=s.n(a),r=s("q1tI"),n=s.n(r),i=s("/MKj"),l=s("17x9"),u=s.n(l),d=s("d2gv"),c=s.n(d),h=s("s0Ty"),p=s.n(h),m=s("Ts+D"),g=s("IkD9"),S=s.n(g),b=s("77UF");var E=()=>e=>S.a.track("Add Course Clicked").then(()=>e(((e="SUCCESS",t=null)=>({type:m.TRACK_COURSE_ADD_LINK_CLICKED,status:e,error:t}))())).catch(b.i),C=s("KAy6"),_=s("IP2g"),y=s("vDqi"),R=s.n(y),N=s("ePoX"),k=s.n(N),f=s("Elhd"),I=s.n(f),w=s("PMJz"),T=s("N4+1");var D=e=>({type:k.a.SET_ADDED_COURSE,addedCourse:e});var v=()=>({type:k.a.ADDING});var O=e=>t=>{t(v());const s={course_code:e.courseCode,course_name:e.courseName,study_id:e.studyId,study_name:e.studyName,institution_id:e.institutionId};R.a.post(I.a.route("APIcourseAddNew"),s).then(e=>{e.data&&(e.data.data.course.status===k.a.NEW_COURSE_ADDED&&t(Object(T.a)(c.a.get("addcourse_thanks"))),t(D(e.data.data.course.result)))}).catch(()=>{t(Object(w.a)(c.a.get("error")))})};var x=(e,t)=>s=>{const a={"University ID":e.id,"University Name":e.name,"University Country ID":e.country.id,"University Country Name":e.country.name,"Added Course Name":t.courseName,"Added Course Code":t.courseCode};return S.a.track("Course Added",a).then(()=>s(((e="SUCCESS",t=null)=>({type:m.TRACK_COURSE_ADDED,status:e,error:t}))())).catch(b.i)};var A=e=>t=>{const s={"Elasticsearch Score":e};S.a.track("Course Suggestion Clicked",s).then(()=>t({type:m.TRACK_COURSE_SUGGESTION_CLICKED})).catch(b.i)},B=s("hiU4"),q=s("r71f");var j=()=>({type:q.d}),U=s("Vg6d");var V=(e,t,s,a,o,r=3)=>(n,i)=>{const l=i(),u={type:"course",locale:l.meta.currentLanguage&&l.meta.currentLanguage.split("-")[0]||"",institutionId:t,courseCode:s,courseName:a,studies:o,size:r};return n(j()),Object(B.a)(l.search,u).then(r=>{const i=r.data.hits.hits;n(Object(U.a)(e,{institutionId:t,courseCode:s,courseName:a,studies:o},i))})},M=s("Yw+G"),L=s("Im2c"),H=s("Rs7A"),K=s("pJVQ"),F=s("e+O+"),W=s("2iE4"),P=s("S3e9"),z=s("dq6K"),G=s("pVnL"),X=s.n(G),Q=s("d/v1"),Y=s("TSYQ"),J=s.n(Y),$=s("BXQg"),Z=s("Rj/V");class ee extends r.Component{constructor(...e){super(...e),o()(this,"shouldShowExtraResult",e=>e&&e.length>=3),o()(this,"extraResultTransformer",e=>c.a.get("use_new_study",{newStudy:e})),o()(this,"renderComponent",({input:{onChange:e,value:t={}},label:s,meta:{touched:a,error:o,warning:r,active:i},id:l=null,placeholder:u=null,hideErrors:d=!1,hideWarnings:c=!1,inputtedValue:h="",resultsClassName:p,...m})=>{const g=l||"search-"+this.props.name,S=!d&&a&&o,b=!c&&a&&r&&!o&&!i;return n.a.createElement("div",{className:J()("form-group",{"has-error":a&&o,"has-warning":b})},s&&n.a.createElement("label",{htmlFor:g},s),n.a.createElement($.a,{layout:"small",formControlStyle:!0,style:{zIndex:20}},n.a.createElement(Z.a,X()({id:g,initialValue:t.name,resultsClassName:J()("search-input-dropdown",p),wrapperClassName:"searchBar__results clearfix",type:"study",placeholder:u,className:"tt-menu__wrapper",onSelect:e,hideNoResultsText:this.shouldShowExtraResult(h),extraResultValue:this.extraResultTransformer(h),onTypedValueSubmitted:()=>e({name:h,id:null}),inputTestSelector:"study-input"},m))),S&&n.a.createElement("div",{className:"form-error-stu"},o),b&&n.a.createElement("div",{className:"form-warning-stu"},r))})}render(){return n.a.createElement(Q.a,X()({component:this.renderComponent},this.props))}}o()(ee,"propTypes",{name:u.a.string.isRequired,id:u.a.string,label:u.a.string,hideErrors:u.a.bool,hideWarnings:u.a.bool,transformer:u.a.func,inputtedValue:u.a.string,resultsClassName:u.a.string}),o()(ee,"defaultProps",{transformer:e=>({...e,id:parseInt(e.id)})});var te=Object(i.connect)(e=>({isApp:e.meta.isApp}))(ee);class se extends r.Component{constructor(...e){super(...e),o()(this,"handleChange",(e,t)=>{const s=this.props.transformer(e);return this.props.onChange&&this.props.onChange(s),t(s)}),o()(this,"renderComponent",({input:{onChange:e,value:t={}},label:s,meta:{touched:a,error:o,warning:r,active:i},id:l=null,placeholder:u=null,hideErrors:d=!1,hideWarnings:c=!1,resultsClassName:h,...p})=>{const m=l||"search-"+this.props.name,g=!d&&a&&o,S=!c&&a&&r&&!o&&!i;return n.a.createElement("div",{className:J()("form-group",{"has-error":a&&o,"has-warning":S})},s&&n.a.createElement("label",{htmlFor:m},s),n.a.createElement($.a,{layout:"small",formControlStyle:!0,style:{zIndex:21}},n.a.createElement(Z.a,X()({id:m,initialValue:t.name,resultsClassName:J()("search-input-dropdown",h),wrapperClassName:"searchBar__results clearfix",type:"institution",placeholder:u,className:"tt-menu__wrapper",onSelect:t=>this.handleChange(t,e),inputTestSelector:m},p))),g&&n.a.createElement("div",{className:"form-error-stu"},o),S&&n.a.createElement("div",{className:"form-warning-stu"},r))})}render(){return n.a.createElement(Q.a,X()({component:this.renderComponent},this.props))}}o()(se,"propTypes",{name:u.a.string.isRequired,id:u.a.string,label:u.a.string,onChange:u.a.func,hideErrors:u.a.bool,hideWarnings:u.a.bool,transformer:u.a.func,resultsClassName:u.a.string}),o()(se,"defaultProps",{transformer:e=>({...e,id:parseInt(e.id)})});var ae=Object(i.connect)(e=>({isApp:e.meta.isApp}))(se);const oe="CourseDetailsForm",re={institution:u.a.object,onSubmit:u.a.func.isRequired,submitting:u.a.bool,initialValues:u.a.shape({institution:u.a.shape({id:u.a.oneOf([u.a.number,u.a.string]),name:u.a.string}),study:u.a.shape({id:u.a.oneOf([u.a.number,u.a.string]),name:u.a.string}),courseCode:u.a.string,courseName:u.a.string}),inputtedStudy:u.a.string,hasCourseCode:u.a.bool.isRequired,hasCourseCodeRequired:u.a.bool.isRequired,hasStudy:u.a.bool.isRequired,hasStudyRequired:u.a.bool.isRequired,hasWarnings:u.a.bool,hasErrors:u.a.bool,...M.a};class ne extends r.Component{constructor(...e){super(...e),o()(this,"state",{showSubmitWarning:!1,submitSucceeded:!1}),o()(this,"handleFormSubmit",({courseName:e="",courseCode:t="",study:{name:s,id:a}={},institution:{id:o}={}})=>this.props.hasWarnings&&!this.state.showSubmitWarning?this.setState({showSubmitWarning:!0}):this.props.onSubmit(o,t.trim(),e.trim(),a,s,this.props.inputtedStudy).then(()=>this.setState({submitSucceeded:!0})).catch(e=>{throw e})),o()(this,"handleInstitutionChange",({id:e=null})=>{this.props.change("study",{}),this.props.fetchInstitution(e)})}componentWillReceiveProps(e){!this.state.showSubmitWarning||e.hasWarnings&&!e.hasErrors||this.setState({showSubmitWarning:!1})}render(){const e=!this.props.hasErrors&&this.props.hasWarnings&&this.state.showSubmitWarning;return n.a.createElement("form",{onSubmit:this.props.handleSubmit(this.handleFormSubmit)},n.a.createElement(W.k.Body,null,this.props.warnings&&n.a.createElement(W.a,{type:"warning"},c.a.get("error")),n.a.createElement(ae,{name:"institution",label:c.a.get("institution"),placeholder:c.a.get("institution"),onChange:this.handleInstitutionChange}),this.props.hasStudy&&n.a.createElement(te,{name:"study",label:c.a.get("study"),placeholder:c.a.get("search_study_placeholder"),resultsClassName:"add-course-modal","data-hj-whitelist":!0,inputtedValue:this.props.inputtedStudy,institutionId:this.props.institution.id}),n.a.createElement(z.a,{name:"courseName",type:"text",maxLength:250,label:c.a.get("course_name"),placeholder:c.a.get("course_name_placeholder"),"data-hj-whitelist":!0}),this.props.hasCourseCode&&n.a.createElement(z.a,{name:"courseCode",type:"text",maxLength:20,label:c.a.get("course_code"),placeholder:c.a.get("course_code_placeholder"),"data-hj-whitelist":!0})),n.a.createElement(W.k.Footer,null,e?n.a.createElement(W.a,{type:"warning",className:"add-course-modal__footer-message"},n.a.createElement("span",null,c.a.get("add_course_warnings")),n.a.createElement(W.e,{type:"submit",className:"alert-stu__button",loading:this.props.submitting||this.state.submitSucceeded,disabled:this.props.submitting||this.state.submitSucceeded},c.a.get("addcourse_confirm"))):n.a.createElement(W.e,{type:"submit",loading:this.props.submitting||this.state.submitSucceeded,disabled:this.props.submitting||this.state.submitSucceeded},c.a.get("addcourse"))))}}ne.propTypes=re;var ie=Object(i.connect)(e=>{const t=e.institution.current,s=(a=e.search.queries,a&&a["search-study"]?a["search-study"].trim():null);var a;const o=Boolean(Object.values(Object(L.a)(oe)(e)).find(Boolean)),r=Boolean(Object.values(Object(H.a)(oe)(e)).find(Boolean));return{institution:t,inputtedStudy:s,hasCourseCode:Boolean(t&&t.has_course_code>0),hasCourseCodeRequired:Boolean(t&&1===t.has_course_code),hasStudy:Boolean(t&&t.has_study>0),hasStudyRequired:Boolean(t&&1===t.has_study),hasWarnings:o,hasErrors:r}},e=>({fetchInstitution:t=>t&&e(Object(F.a)(t))}))(Object(K.a)({form:oe,validate:({courseName:e="",courseCode:t="",study:s={}},{hasCourseCodeRequired:a,hasStudyRequired:o})=>({courseName:Object(P.l)(e,"course_name"),courseCode:Object(P.b)({courseCode:t,courseName:e},{hasCourseCodeRequired:a,trim:20}),study:o?Object(P.l)(s.name||"","study"):null}),warn:({courseCode:e="",courseName:t=""},{hasCourseCode:s})=>({courseName:Object(P.q)({courseName:t}),courseCode:Object(P.p)({courseCode:e,courseName:t},{hasCourseCode:s})})})(ne)),le=s("QF9i");const ue={COURSE_DETAILS:"COURSE_DETAILS",PICK_EXISTING_COURSE_OR_ADD_NEW:"PICK_EXISTING_COURSE_OR_ADD_NEW"},de={institution:u.a.object,onCourseAdded:u.a.func,addedCourse:u.a.object,onHide:u.a.func,show:u.a.bool,dispatch:u.a.func.isRequired,searchStatus:u.a.string,searchCourseResults:u.a.array,addCourseStatus:u.a.string};class ce extends r.Component{constructor(...e){super(...e),o()(this,"state",ce.INITIAL_STATE),o()(this,"handleSubmitCourseDetails",(e,t,s,a,o,r)=>(this.setState({courseDetails:{institutionId:e,courseCode:t,courseName:s,studyId:a,studyName:o||r}}),this.props.dispatch(V(ce.SEARCH_SIMILAR_COURSES_KEY,e,t,s,o?[o]:[])))),o()(this,"handleAddCourse",()=>this.props.dispatch(O(this.state.courseDetails))),o()(this,"handlePickSimilarCourse",e=>(this.props.dispatch(A(e.elasticMeta.score)),this.props.onCourseAdded(e))),o()(this,"handleShowCourseDetailsForm",()=>{this.setState({step:ue.COURSE_DETAILS})})}componentDidUpdate(e){!e.show&&this.props.show&&this.setState(ce.INITIAL_STATE),e.searchStatus===q.d&&this.props.searchStatus===q.e&&(this.props.searchCourseResults.length?this.setState({step:ue.PICK_EXISTING_COURSE_OR_ADD_NEW}):this.props.dispatch(O(this.state.courseDetails))),e.addCourseStatus===k.a.ADDING&&this.props.addCourseStatus===k.a.ADDED&&(this.props.onCourseAdded(this.props.addedCourse),this.props.dispatch(x(this.props.institution,this.state.courseDetails)))}render(){let e;if(this.state.step===ue.COURSE_DETAILS)e=n.a.createElement(ie,{onSubmit:this.handleSubmitCourseDetails,submitting:this.props.searchStatus===q.d||this.props.addCourseStatus===k.a.ADDING,initialValues:{institution:this.props.institution&&{id:this.props.institution.id,name:this.props.institution.name}}});else if(this.state.step===ue.PICK_EXISTING_COURSE_OR_ADD_NEW){const t=this.props.searchCourseResults.map((e,t)=>{let s;return e.codes&&e.codes.length&&(s=n.a.createElement("span",{className:"similar-course__code"},e.codes[0])),n.a.createElement("li",{key:e.id,className:"similar-course",onClick:()=>this.handlePickSimilarCourse(e)},n.a.createElement(le.a,{size:"small"}),n.a.createElement("span",{className:"similar-course__name"},e.name),s,n.a.createElement(_.a,{icon:"chevron-right",className:"similar-course__picker"}))});e=n.a.createElement(r.Fragment,null,n.a.createElement(W.k.Body,null,n.a.createElement("p",null,n.a.createElement("span",{dangerouslySetInnerHTML:{__html:c.a.get("adding_course",{courseDetails:Object(C.renderToString)(n.a.createElement("span",{className:"font-bold"},this.state.courseDetails.courseName," (",this.state.courseDetails.courseCode,")"))})}}),n.a.createElement("br",null),n.a.createElement("span",null,c.a.get("same_course_as_below"))),n.a.createElement("ul",{className:"list-unstyled"},t),n.a.createElement("p",{dangerouslySetInnerHTML:{__html:c.a.get("select_or_proceed",{buttonCopy:Object(C.renderToString)(n.a.createElement("span",{className:"font-bold"},c.a.get("add_new_course")))})}})),n.a.createElement(W.k.Footer,null,n.a.createElement(W.d,null,n.a.createElement(W.k.CancelButton,{onClick:this.handleShowCourseDetailsForm},c.a.get("previous")),n.a.createElement(W.k.SubmitButton,{component:W.e,disabled:this.props.addCourseStatus===k.a.ADDING,loading:this.props.addCourseStatus===k.a.ADDING,onClick:this.handleAddCourse},c.a.get("add_new_course")))))}return n.a.createElement(W.k,{show:this.props.show,onHide:this.props.onHide,className:"add-course-modal"},n.a.createElement(W.k.Header,null,c.a.get("addcourse")),e)}}o()(ce,"SEARCH_SIMILAR_COURSES_KEY","similarCourses"),o()(ce,"INITIAL_STATE",{courseDetails:{},step:ue.COURSE_DETAILS}),ce.propTypes=de;var he=Object(i.connect)(e=>{var t;return{institution:e.institution.current,addedCourse:e.course.addedCourse,searchStatus:e.search.searchStatus,searchCourseResults:(null===(t=e.search.results)||void 0===t?void 0:t[ue.SEARCH_SIMILAR_COURSES_KEY])||[],addCourseStatus:e.course.addCourseStatus}})(ce);class pe extends r.Component{constructor(...e){super(...e),o()(this,"state",{showModal:!1}),o()(this,"handleClick",()=>{this.props.dispatch(E()),this.setState({showModal:!0})}),o()(this,"handleHideModal",()=>{this.setState({showModal:!1})})}render(){return n.a.createElement("div",{className:p.a.buttonWrapper},n.a.createElement(he,{show:this.state.showModal,onHide:this.handleHideModal,onCourseAdded:this.props.onSubmitted}),n.a.createElement(W.c,{size:"wide",color:"clear",className:p.a.button,onClick:this.handleClick,type:"button"},n.a.createElement(_.a,{icon:"question-circle"})," ",c.a.get("add_course")))}}o()(pe,"propTypes",{onSubmitted:u.a.func.isRequired,dispatch:u.a.func.isRequired});t.default=Object(i.connect)()(pe)},"Rj/V":function(e,t,s){"use strict";var a=s("lSNA"),o=s.n(a),r=s("q1tI"),n=s.n(r),i=s("17x9"),l=s.n(i),u=s("/MKj"),d=s("i8i4"),c=s.n(d),h=s("d2gv"),p=s.n(h),m=s("TSYQ"),g=s.n(m),S=s("b6Qr"),b=s("IP2g"),E=s("77UF"),C=s("pVnL"),_=s.n(C),y=s("kX0S");class R extends r.Component{constructor(...e){super(...e),o()(this,"handleExtraResultClick",e=>{e.preventDefault(),this.props.onExtraResultClick()})}render(){let e,t,a;if(this.props.showAddButtons){const t="course"===this.props.type&&["acquisitionUniversityUploader","documentUpload","acquisitionUploader"].includes(this.props.currentRoute),a=this.props.user&&this.props.user.isLoggedIn&&("course"===this.props.type||"book"===this.props.type||"institution"===this.props.type);if(t||a)if("course"===this.props.type){const t=s("+UO9").default;e=n.a.createElement(t,{onSubmitted:this.props.onSelect,institution:this.props.institution})}else if("book"===this.props.type){const t=s("VWwz").default;e=n.a.createElement(t,{courseId:this.props.courseId,onSubmitted:this.props.onSelect})}}if(0===this.props.results.length)this.props.hideNoResultsText||(a=n.a.createElement("div",{className:this.props.wrapperClassName},n.a.createElement("div",{className:"noSearchResults"},this.props.noResultsMessage)));else{const e=this.props.liComponent,t=this.props.results.map((t,s)=>n.a.createElement(e,_()({},t,{className:g()({"tt-cursor":this.props.highlightedResultIndex===s}),key:t.id,searchPos:s+1,onSelected:this.props.onSelect,link:this.props.link,type:this.props.type,country:t.country})));a=n.a.createElement("ul",{className:this.props.wrapperClassName},t)}return this.props.extraResultValue&&this.props.onExtraResultClick&&(t=n.a.createElement("div",{className:"extra-results"},n.a.createElement("button",{className:"extra-results__button",onClick:this.handleExtraResultClick},this.props.extraResultValue))),n.a.createElement("div",{className:this.props.className},a,t,e)}}o()(R,"propTypes",{results:l.a.array.isRequired,institution:l.a.object.isRequired,currentRoute:l.a.string.isRequired,noResultsMessage:l.a.oneOfType([l.a.string,l.a.node]).isRequired,onSelect:l.a.func.isRequired,type:l.a.string.isRequired,liComponent:l.a.func.isRequired,link:l.a.bool.isRequired,user:l.a.object,courseId:l.a.number,showAddButtons:l.a.bool,wrapperClassName:l.a.string,dataTestSelector:l.a.string,className:l.a.string,highlightedResultIndex:l.a.number,hideNoResultsText:l.a.bool,extraResultValue:l.a.string,onExtraResultClick:l.a.func}),o()(R,"defaultProps",{user:{isLoggedIn:!1},results:[],showAddButtons:!1});var N=Object(y.connect)((e,t)=>{const s=e.search.results[t.id];let a=e.institution&&e.institution.current;return a||(a={id:e.search.institutionId,institutionId:e.search.institutionId,institutionName:e.search.institutionName}),{results:s,institution:a,currentRoute:e.meta.currentRoute}})(R),k=s("YcKG"),f=s.n(k),I=s("KvvS"),w=s("QF9i"),T=s("XYnV"),D=s("hmLP"),v=s("dNc6"),O=s.n(v);const x={id:l.a.oneOfType([l.a.string,l.a.number]).isRequired,name:l.a.string.isRequired,type:l.a.oneOf(["book","course","institution","study"]).isRequired,onSelected:l.a.func.isRequired,link:l.a.bool,className:l.a.string,authors:l.a.array,codes:l.a.array,study_search_is_visible:l.a.bool,studies:l.a.array,country:l.a.shape({geocode:l.a.string,name:l.a.string})};class A extends r.Component{constructor(...e){super(...e),o()(this,"handleSelected",()=>{let e;this.props.authors&&(e=this.props.authors.join(", ")),this.props.onSelected({id:this.props.id,name:this.props.name,value:this.props.name,codes:this.props.codes,author:e})})}render(){let e,t,s;if("book"===this.props.type)e=this.props.authors.join(", "),s=n.a.createElement(I.a,{size:"small",className:"hidden-xs pull-left"});else if("course"===this.props.type)e="",s=n.a.createElement(w.a,{size:"small",className:"hidden-xs pull-left"}),this.props.codes.length>0&&(e=this.props.codes[0]),this.props.study_search_is_visible&&this.props.studies.length>0&&(e=(e.length?e+" | ":"")+this.props.studies.join(", "));else if("institution"===this.props.type){var a;s=n.a.createElement(T.a,{size:"small",className:"hidden-xs pull-left"}),(null===(a=this.props.country)||void 0===a?void 0:a.geocode)&&(s=n.a.createElement(D.a,{className:g()("ic",O.a.flag),size:"small",geocode:this.props.country.geocode.toLowerCase()}))}const o=n.a.createElement("div",{className:"suggestion-name-wrapper"},n.a.createElement("span",{className:"suggestion-name"},this.props.name),n.a.createElement("span",null,e));return t=this.props.link?n.a.createElement("a",{className:"search-suggestions__links search-suggestions__materialLink",href:f.a[this.props.type](this.props)},n.a.createElement("div",{className:"ic-text ic-text--top"},s,o)):n.a.createElement("div",{className:"search-suggestions__links search-suggestions__materialLink","data-id":this.props.id,onClick:this.handleSelected},n.a.createElement("div",{className:"ic-text ic-text--top"},s,o)),n.a.createElement("li",{className:g()("search-suggestions",this.props.className)},t)}}A.propTypes=x,A.defaultProps={link:!1,className:"",authors:[],codes:[],study_search_is_visible:!1,studies:[],country:null};var B=A,q=s("NgxB"),j=s("GVZ9"),U=s("0pXI");var V=e=>t=>{let s;switch(e){case"institution":s="University";break;case"course":s="Course";break;default:throw new Error("Wrong type")}return t(Object(U.a)(s+" Search Started"))},M=s("2iE4");const L={id:l.a.string.isRequired,type:l.a.string.isRequired,query:l.a.string,initialValue:l.a.string,value:l.a.string,isSearching:l.a.bool,spinner:l.a.bool,resultsNumber:l.a.number.isRequired,results:l.a.array,searchComponent:l.a.func,clearOnSelected:l.a.bool,noResultsMessage:l.a.oneOfType([l.a.node,l.a.string]),showAddButtons:l.a.bool,resultsTestSelector:l.a.string,resultsClassName:l.a.string,wrapperClassName:l.a.string,clearable:l.a.bool,clearTestSelector:l.a.string,onClear:l.a.func,disabled:l.a.bool,placeholder:l.a.string,autofocus:l.a.bool,inputClassName:l.a.string,inputTestSelector:l.a.string,user:l.a.object,institutionId:l.a.number,courseId:l.a.number,onChange:l.a.func,onToggleResults:l.a.func,onBlur:l.a.func,onFocus:l.a.func,onSelect:l.a.func,className:l.a.string,dispatch:l.a.func.isRequired,onTypedValueSubmitted:l.a.func,hideNoResultsText:l.a.bool,extraResultValue:l.a.string,shouldTrackSearchStarted:l.a.bool},H={searchComponent:B,initialValue:"",onChange:E.i,onClear:E.i,onToggleResults:E.i,onBlur:E.i,onSelect:E.i,onFocus:E.i,results:[],query:null,value:null,isSearching:!1,spinner:!1,clearOnSelected:!1,noResultsMessage:null,showAddButtons:!1,resultsTestSelector:null,resultsClassName:null,wrapperClassName:null,clearable:!1,clearTestSelector:null,disabled:!1,placeholder:null,autofocus:!1,inputClassName:null,inputTestSelector:null,user:null,institutionId:null,courseId:null,className:null,onTypedValueSubmitted:E.i,hideNoResultsText:!0,extraResultValue:null,shouldTrackSearchStarted:!1};class K extends r.Component{constructor(...e){super(...e),o()(this,"state",{forceHideDropdown:!0,inputValue:this.props.initialValue,highlightedResultIndex:-1,searchStartedTracked:!1}),o()(this,"handleCloseDropdown",e=>{this.state.forceHideDropdown||c.a.findDOMNode(this).contains(e.target)||("function"==typeof this.props.onBlur&&this.props.onBlur(),this.setState({forceHideDropdown:!0},this.handleToggleResults))}),o()(this,"handleResultSelected",e=>{const t={forceHideDropdown:!0};e?(this.props.onSelect(e),this.props.clearOnSelected?t.inputValue="":t.inputValue=e.value||e.name||""):"function"==typeof this.props.onTypedValueSubmitted&&this.props.onTypedValueSubmitted(),this.setState(t,this.handleToggleResults),this.props.onBlur()}),o()(this,"handleInputFocus",e=>{this.props.onFocus(e),this.props.query&&this.props.query.length>0&&this.setState({forceHideDropdown:!1},this.handleToggleResults)}),o()(this,"handleChange",e=>{this.props.onChange(e),this.shouldTrackSearchStarted(e)&&(this.setState({searchStartedTracked:!0}),this.props.dispatch(V(this.props.type))),this.setState({inputValue:e})}),o()(this,"handleSearch",e=>{this.props.dispatch(Object(j.a)(this.props.id,e,this.props.type,this.props.resultsNumber,this.props.institutionId)),this.setState({forceHideDropdown:0===e.length},this.handleToggleResults)}),o()(this,"handleClearInput",()=>{this.props.onClear(),this.setState({inputValue:"",forceHideDropdown:!0},this.handleToggleResults)}),o()(this,"handleToggleResults",()=>{"function"==typeof this.props.onToggleResults&&this.props.onToggleResults(this.state.forceHideDropdown)}),o()(this,"handleKeyboardNavigation",e=>{if(!this.areResultsHidden()&&this.props.results.length>0)switch(e.keyCode){case 38:this.state.highlightedResultIndex<=0?this.setState({highlightedResultIndex:this.props.results.length-1}):this.setState(e=>({highlightedResultIndex:e.highlightedResultIndex-1}));break;case 40:this.state.highlightedResultIndex===this.props.results.length-1?this.setState({highlightedResultIndex:0}):this.setState(e=>({highlightedResultIndex:e.highlightedResultIndex+1}));break;case 9:case 13:{e.preventDefault();const t=this.props.results[this.state.highlightedResultIndex];this.handleResultSelected(t),this.setState({highlightedResultIndex:-1});break}case 27:this.setState({forceHideDropdown:!0},this.handleToggleResults),this.setState({highlightedResultIndex:-1})}}),o()(this,"areResultsHidden",()=>this.state.forceHideDropdown||this.props.isSearching&&0===this.props.results.length),o()(this,"shouldTrackSearchStarted",e=>1===e.length&&this.props.shouldTrackSearchStarted&&!this.state.searchStartedTracked)}componentDidMount(){window.addEventListener("mousedown",this.handleCloseDropdown,!1)}componentWillUnmount(){window.removeEventListener("mousedown",this.handleCloseDropdown,!1)}render(){const{isSearching:e}=this.props;let t,s,a;return this.props.spinner&&e&&(t=n.a.createElement(M.o,{size:"small",fixed:"right"})),this.props.clearable&&(s=n.a.createElement(M.c,{color:"clear",size:"minimum",onClick:this.handleClearInput,className:"dropdown-typeahead__dismiss"},n.a.createElement(b.a,{icon:"times"}))),a=null!==this.props.value?this.props.value:this.state.inputValue,n.a.createElement("div",{onKeyDown:this.handleKeyboardNavigation,className:g()("dropdown-typeahead",this.props.className)},n.a.createElement("div",{className:"ElasticTypeaheadInput"},n.a.createElement(q.a,{id:this.props.id,className:this.props.inputClassName,placeholder:this.props.placeholder,value:a,debounceTimeout:S.isMobile?800:400,autofocus:this.props.autofocus,onImmediateChange:this.handleChange,onChange:this.handleSearch,onFocus:this.handleInputFocus,onBlur:this.props.onBlur,disabled:this.props.disabled,dataTestSelector:this.props.inputTestSelector}),t,s),n.a.createElement(N,{id:this.props.id,type:this.props.type,className:g()(this.props.resultsClassName,{hidden:this.areResultsHidden()}),onSelect:this.handleResultSelected,liComponent:this.props.searchComponent,link:!this.props.onSelect,wrapperClassName:this.props.wrapperClassName,user:this.props.user,noResultsMessage:this.props.noResultsMessage||p.a.get("no_results"),showAddButtons:this.props.showAddButtons,courseId:this.props.courseId,dataTestSelector:this.props.resultsTestSelector,ref:this.searchResults,highlightedResultIndex:this.state.highlightedResultIndex,extraResultValue:this.props.extraResultValue,onExtraResultClick:this.props.extraResultValue&&this.handleResultSelected,hideNoResultsText:this.props.hideNoResultsText}))}}K.propTypes=L,K.defaultProps=H;t.a=Object(u.connect)((e,t)=>({isSearching:!0===e.search.isSearching[t.id],query:e.search.queries[t.id],results:e.search.results[t.id]}))(K)},VWwz:function(e,t,s){"use strict";s.r(t);var a=s("lSNA"),o=s.n(a),r=s("q1tI"),n=s.n(r),i=s("d2gv"),l=s.n(i),u=s("17x9"),d=s.n(u),c=s("s0Ty"),h=s.n(c),p=s("/MKj"),m=s("vDqi"),g=s.n(m),S=s("Elhd"),b=s.n(S),E=s("N4+1"),C=s("PMJz"),_=s("ePoX"),y=s.n(_);var R=()=>({type:y.a.ADD_BOOK_SUBMITTING});var N=e=>({type:y.a.ADD_BOOK_SUBMITTED,book:e});var k=()=>({type:y.a.ADD_BOOK_NOT_SUBMITTED}),f=s("BAHx");var I=e=>t=>{t(R());const s={...e,ISBN:Object(f.a)(e.ISBN)};return g.a.post(b.a.route("api.books.store"),s).then(({data:{data:e,message:s=null}})=>{t(N({name:e.title,title:e.title,id:e.id,authors:[e.author],author:e.author})),t(Object(E.a)(s||l.a.get("thanks_contribution"),"success"))}).catch(({message:e})=>{t(Object(C.a)(e)),t(k())})},w=s("Yw+G"),T=s("pJVQ"),D=s("S3e9"),v=s("KvvS"),O=s("dq6K"),x=s("BXQg"),A=s("uEEt"),B=s("2iE4");class q extends r.Component{constructor(...e){super(...e),o()(this,"state",{results:null,totalResults:0}),o()(this,"handleBookSearch",(e,t)=>g.a.post(b.a.route("APIbookSearchGoogle"),{query:e.book}).then(({data:{data:{results:e,totalResults:t}}})=>this.setState({results:e,totalResults:t})).catch(()=>t(Object(C.a)())))}render(){const{results:e,totalResults:t}=this.state;let s=null;if(e){let a=null,o=null,r=null;if(e.length){const s=l.a.get("select_book"),a=l.a.get("results_out_of_total",{resultsShowed:e.length,resultsTotal:t});o=`${s} (${a})`,r=e.map((e,t)=>n.a.createElement("tr",{onClick:()=>this.props.onResultSelected(e),style:{cursor:"pointer"},className:"document-list item-show book-tr-add",key:t},n.a.createElement("td",{width:"20"},n.a.createElement(v.a,{size:"small"})),n.a.createElement("td",null,e.title,n.a.createElement("br",null),n.a.createElement("span",{className:"filename"},e.ISBN," - ",e.author))))}else a=n.a.createElement("span",null,l.a.get("no_results"));s=n.a.createElement("div",{className:"select-book"},n.a.createElement("h3",null,o),n.a.createElement("table",{className:"table table-hover table-condensed book-list-add"},n.a.createElement("tbody",null,r)),a)}return n.a.createElement("form",{onSubmit:this.props.handleSubmit(this.handleBookSearch)},n.a.createElement("div",{className:"mb1x"},n.a.createElement(x.a,{formControlStyle:!0,layout:"small"},n.a.createElement(O.a,{formGroupClassName:"mb0x",name:"book",type:"text",maxLength:100,placeholder:l.a.get("search_book_placeholder"),hideErrors:!0})),n.a.createElement(A.a,{name:"book_query"})),n.a.createElement(B.e,{size:"wide",type:"submit",loading:this.props.submitting,disabled:this.props.submitting},l.a.get("search_google_button")),s)}}o()(q,"propTypes",{onResultSelected:d.a.func.isRequired,...w.a});var j=Object(T.a)({form:"GoogleBookForm",validate:e=>({book:Object(D.l)(e.book,"book")})})(q);class U extends r.Component{render(){return n.a.createElement("form",{onSubmit:this.props.handleSubmit},n.a.createElement(O.a,{name:"title",maxLength:250,label:l.a.get("title")}),n.a.createElement(O.a,{name:"author",maxLength:250,label:l.a.get("author")}),n.a.createElement(O.a,{name:"ISBN",maxLength:25,label:l.a.get("book_isbn")}))}}U=Object(T.a)({form:"BookAddForm",validate:e=>({title:Object(D.l)(e.title,"title"),author:Object(D.l)(e.author,"author"),ISBN:Object(D.e)(e.ISBN)})})(U);var V=U;const M={onBookAdded:d.a.func.isRequired,show:d.a.bool.isRequired,onHidden:d.a.func.isRequired,submitBookStatus:d.a.string,addedBook:d.a.object,dispatch:d.a.func.isRequired};class L extends r.Component{constructor(...e){super(...e),o()(this,"state",{manualEntry:!1,loadingResults:!1,manualInitialValues:{}}),o()(this,"handleBookFormSubmit",()=>this.bookAddForm.submit()),o()(this,"handleBookSubmitted",e=>{this.hasIncompleteFields(e)?this.switchToManualEntry(e):this.props.dispatch(I(e))}),o()(this,"hasIncompleteFields",({ISBN:e="",author:t="",title:s=""})=>Boolean(!e.trim()||!t.trim()||!s.trim())),o()(this,"switchToManualEntry",e=>{this.setState({manualEntry:!0,manualInitialValues:e})}),o()(this,"handleManualEntryClick",()=>this.setState(e=>({manualEntry:!e.manualEntry,manualInitialValues:{}})))}static getDerivedStateFromProps(e){switch(e.submitBookStatus){case y.a.ADD_BOOK_SUBMITTING:return{loadingResults:!0};case y.a.ADD_BOOK_SUBMITTED:case y.a.ADD_BOOK_NOT_SUBMITTED:return{loadingResults:!1};default:return null}}componentDidUpdate(e){this.props.submitBookStatus!==e.submitBookStatus&&this.props.submitBookStatus===y.a.ADD_BOOK_SUBMITTED&&this.props.onBookAdded(this.props.addedBook)}render(){return this.state.manualEntry?n.a.createElement(B.k,{show:this.props.show,onHide:this.props.onHidden,className:"book-modal"},n.a.createElement(B.k.Header,null,l.a.get("add_book_title")),n.a.createElement(B.k.Body,null,n.a.createElement(V,{ref:e=>{this.bookAddForm=e},initialValues:this.state.manualInitialValues,onSubmit:this.handleBookSubmitted})),n.a.createElement(B.k.Footer,null,n.a.createElement(B.d,null,n.a.createElement(B.k.CancelButton,{onClick:this.handleManualEntryClick,disabled:this.state.loadingResults},l.a.get("back_to_search")),n.a.createElement(B.k.SubmitButton,{component:B.e,disabled:this.state.loadingResults,loading:this.state.loadingResults,onClick:this.handleBookFormSubmit},l.a.get("add_book_title"))))):n.a.createElement(B.k,{show:this.props.show,onHide:this.props.onHidden,className:"book-modal"},n.a.createElement(B.k.Header,null,l.a.get("add_book_title")),n.a.createElement(B.k.Body,null,n.a.createElement(j,{onResultSelected:this.handleBookSubmitted})),n.a.createElement(B.k.Footer,null,n.a.createElement("div",{className:"text-center book-add"},n.a.createElement(B.c,{size:"minimum",color:"link",className:"font-size-small",onClick:this.handleManualEntryClick},l.a.get("or_add_manually")))))}}L.propTypes=M;var H=Object(p.connect)(e=>({submitBookStatus:e.course.submitBookStatus,addedBook:e.course.addedBook}))(L),K=s("IP2g");class F extends r.Component{constructor(...e){super(...e),o()(this,"state",{showModal:!1}),o()(this,"handleClick",e=>{e.preventDefault(),this.setState({showModal:!0})}),o()(this,"handleModalHidden",()=>this.setState({showModal:!1})),o()(this,"handleBookAdded",e=>this.setState({showModal:!1},()=>this.props.onSubmitted(e)))}render(){return n.a.createElement("div",{className:h.a.buttonWrapper},n.a.createElement(H,{show:this.state.showModal,onHidden:this.handleModalHidden,onBookAdded:this.handleBookAdded,courseId:this.props.courseId}),n.a.createElement(B.c,{size:"wide",color:"clear",className:h.a.button,onClick:this.handleClick},n.a.createElement(K.a,{icon:"question-circle"})," ",l.a.get("add_book")))}}o()(F,"propTypes",{courseId:d.a.number,onSubmitted:d.a.func.isRequired});t.default=F},dNc6:function(e,t,s){e.exports={flag:"flag--1guC-"}},s0Ty:function(e,t,s){e.exports={"button-wrapper":"button-wrapper--3kOJ1",buttonWrapper:"button-wrapper--3kOJ1",button:"button--kDsWF"}}}]);